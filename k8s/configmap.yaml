apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-config
  namespace: portfolio
  labels:
    app.kubernetes.io/name: frontend
    app.kubernetes.io/part-of: portfolio
data:
  APP_NAME: "Frontend"
  APP_ENV: "production"
  APP_DEBUG: "false"
  APP_URL: "https://portfolio.kube"
  LOG_CHANNEL: "stderr"
  REDIS_HOST: "frontend-redis"
  REDIS_PORT: "6379"
  # Internal service-to-service URLs (Kubernetes DNS)
  BLOG_API_URL_INTERNAL: "http://blog"
  USERS_API_URL_INTERNAL: "http://users"
  SSO_INTERNAL_URL: "http://sso"
  # External SSO URL (for browser redirects)
  SSO_URL: "https://sso.portfolio.kube"
  # OAuth credentials (generate proper values in production)
  SSO_CLIENT_ID: "frontend-client"
  SSO_CLIENT_SECRET: "frontend-secret-change-in-production"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-nginx-config
  namespace: portfolio
  labels:
    app.kubernetes.io/name: frontend
    app.kubernetes.io/component: nginx
    app.kubernetes.io/part-of: portfolio
data:
  default.conf: |
    server {
        listen 80;
        server_name _;
        root /var/www/html/public;
        index index.php;

        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        location ~ \.php$ {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME /var/www/html/public$fastcgi_script_name;
            include fastcgi_params;
        }

        location ~ /\.(?!well-known).* {
            deny all;
        }
    }
